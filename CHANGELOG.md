# CHANGELOG

## 2025-12-30
### 機能追加: おすすめ賭け方表示
**変更内容**:
- `app/page.tsx` を更新:
  - `getBetRecommendation()` 関数を追加
  - レースカードに「単勝」「複勝」バッジを表示
  - 単勝: 1位が50%以上かつ2位と15%以上差がある場合
  - 複勝: 混戦（上位が拮抗）の場合

### 改善: 妙味基準を厳格化
**変更内容**:
- 妙味バッジ(🔥)の基準を変更:
  - 変更前: 期待値 > 1.5
  - 変更後: 期待値 > 2.5（かなり厳選）

### 機能追加: リアルタイム成績表示
**変更内容**:
- `app/page.tsx` を更新:
  - `calculateStats()` 関数を追加（成績計算）
  - レース一覧の上に成績カードを表示
  - 表示項目: 単勝的中率、複勝的中率、回収率
  - 回収率100%以上で緑、未満で赤の背景色
  - 追加APIリクエストなし（結果データから計算）

### 機能追加: レース結果表示
**変更内容**:
- `app/page.tsx` を更新:
  - 終了したレースの結果（1-2-3着）をカードヘッダーに表示
  - 結果確定時はカードの色が紫色に変化
  - モーダル内で各馬に着順バッジを表示（金/銀/銅色）
  - `/api/odds`の`result`フィールドを使用（追加APIリクエストなし）

### 機能追加: モデル情報表示
**変更内容**:
- `app/page.tsx` を更新:
  - 競馬場選択時にモデル情報を取得・表示
  - 表示項目: 学習データ件数、期間、精度(AUC)、最終学習日
  - フォームカードの下部に表示

### 機能追加: 事前計算対応（高速表示）
**変更内容**:
- `app/page.tsx` の `handlePredict` を改修:
  - まず事前計算済み予測JSONを取得（一瞬で表示）
  - オッズのみリアルタイム取得（軽量）
  - 事前計算なしの場合は従来のリアルタイム予測にフォールバック
- **効果**: 事前計算済みなら開いた瞬間に全レース表示

### 改善: UI/UX改善（3項目）
**変更内容**:
- `app/page.tsx` を更新:
  - **馬名見切れ修正**: カード内の馬名表示幅を調整（`maxWidth: 120px` + text-overflow）
  - **妙味バッジを絵文字に変更**: 「妙味」→「🔥」に変更（視認性向上）
  - **妙味基準説明更新**: モーダルフッターを「= 期待値 > 1.5（狙い目）」に変更

### 修正: 勝率・複勝率の表示バグ
**問題**: 勝率が5000%、複勝率が10000%と表示される
**原因**: バックエンドが既にパーセンテージ（80など）を返しているのに、フロントエンドでさらに`* 100`していた
**変更内容**:
- `app/page.tsx` のモーダル内の勝率・複勝率表示から`* 100`を削除

### 機能追加: オッズ・騎手・詳細モーダル実装
**変更内容**:
- `app/page.tsx` を更新:
  - **オッズ表示**: 色分け表示（赤 <5倍、オレンジ <10倍、灰 ≥10倍）
  - **騎手名表示**: 馬名の下に表示
  - **勝率・複勝率表示**: カード内に%表示
  - **期待値表示**: AI予測 × オッズ（妙味判定）
  - **レース詳細モーダル**: カードクリックで全馬の詳細表示
    - 順位、馬番、馬名/騎手、オッズ、勝率、複勝率、AI予測を列表示
    - 妙味あり（期待値 > 1）は緑色でハイライト
  - **他X頭表示**: カードに上位3頭 + 残り頭数を表示

### リファクタ: expense-appデザイン完全適用
**変更内容**:
- `app/page.tsx` を完全書き換え:
  - **ティールカラー** (`#0d9488`) ベースのデザイン
  - **ミント背景** (`#e8f5f3`)
  - **グラデーションヘッダー** (ティール)
  - **白カード** + ティールグラデーションヘッダー + 16px角丸
  - **アウトライン入力** (12px角丸)
  - **順位バッジ** (金/銀/銅グラデーション)
  - **馬番サークル** (ティールグラデーション)
  - **モバイル対応**: 下部ナビゲーション (md:hidden)
  - インラインスタイル使用 (Tailwind v4互換性のため)

## 2025-12-29
### リファクタ: HeroUI導入
**変更内容**:
- `package.json` に依存関係追加:
  - `@heroui/react` - モダンUIコンポーネントライブラリ
  - `framer-motion` - アニメーションライブラリ

- `app/providers.tsx` を新規作成:
  - HeroUIProviderでアプリをラップ

- `app/layout.tsx` を更新:
  - Providersコンポーネントを追加
  - ライトモードに変更 (`className="light"`)

### 修正: 全馬のオッズを常に表示
**変更内容**:
- `app/page.tsx` を更新
  - オッズ表示を全馬に対して常に表示するよう修正
  - オッズが取得できない場合は「-」を表示
  - 妙味あり（期待値>1）の馬のみ緑色で表示

### 機能追加: FastAPI連携
**変更内容**:
- `app/page.tsx` を更新
  - APIエンドポイント呼び出し機能を追加
  - 型定義（Prediction, Race）を追加
  - エラーハンドリングを実装
  - 競馬場一覧を14競馬場に拡充（水沢、笠松、姫路を追加）
  - 空状態・エラー状態の表示を改善

### 機能追加: デプロイ設定
**変更内容**:
- `.env.example` を新規作成 - 環境変数のテンプレート
- `.env.local` を新規作成 - ローカル開発用環境変数

### 機能追加: モダンUI実装
**変更内容**:
- `app/globals.css` を更新
  - ダークモード配色を改善（純黒 → ダークネイビー #0F172A）
  - グラデーションクラス追加（gradient-primary, gradient-gold, gradient-silver, gradient-bronze）
  - グラスモーフィズムエフェクト追加
  - カスタムスクロールバースタイル追加

- `app/page.tsx` を更新
  - PC/モバイルレスポンシブ対応
  - PC: 左サイドバー + 2-3カラムグリッド
  - モバイル: ボトムナビ + 横スクロールタブ
  - 予測結果カードにグラデーション装飾
